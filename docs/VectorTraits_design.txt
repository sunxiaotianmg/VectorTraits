# VectorTraits_design

## Conditional compilation symbols(条件编译符号)

- UNSAFE: 是否使用 unsafe 关键字。
- UNSAFE_USE_TRAITS: 是否使用 unsafe 版的 VectorTraits 。
- SOFTWARE_OPTIMIZATION: Software algorithm optimization（软件算法优化）, 会利用其它向量函数组合实现. 如 ShiftLeft_Multiply、ShiftRightArithmetic_Var64 .
- HARDWARE_OPTIMIZATION: Hardware algorithm optimization（硬件算法优化）, 会尝试更优化的算法. 如 ShiftRightArithmeticFast_If .
- BCL_OVERRIDE_BASE_FIXED: 用有硬件加速的新版 BCL 库的方法来覆盖固定长度向量的算法. 仅对有硬件加速的来使用.
- BCL_OVERRIDE_BASE_VAR: 用新版 BCL 库的方法来覆盖可变长度向量的算法. 它一般需要通过分支或循环来实现，性能不一定比BCL算法优化。且能获得.NET版本更新带来的改进，故用它。
- BCL_BASE_OVERRIDE_STATIC: 对于特性静态方法（Vectors.Traits.cs等文件）, 是否直接调用Base版的静态方法, 而不是动态调用接口方法。因为低版本.NET（< `.NET Core 3.0`）在通过接口调用封固类方法时，不会内联。实际测试后发现，`.NET Core 3.0`才开始支持“在通过接口调用封固类方法时的内联”，而且该版本才支持内在函数。
- DRY_JOB: 性能评测时使用 DryJob , 仅运行一次快速得到汇编代码.
- BENCHMARKS_OFF: 关闭评测 . 用于专门测试某个评测时，此时仅需专门打开某一个评测。
- BENCHMARKS_128ALGORITHM: 评测各种128位底层算法.
- BENCHMARKS_256ALGORITHM: 评测各种256位底层算法.
- BENCHMARKS_ALGORITHM: 评测各种底层算法. 如 ShiftLeft_Multiply .
- BENCHMARKS_RAW: 评测各种原始用法. 如 SumSLLRawAvx2 .
- BENCHMARKS_TRAITS_USAGES: 评测特征的各种用法. 如 SumSLLTraitsArg, SumSLLTraitsOverload .
- BENCHMARKS_TARGET_FAST: 评测目标方法的快速版.

注: 若配置的条件编译符号带了“0”后缀的, 表示关闭. 例如“BCL_BASE_OVERRIDE_STATIC0”, 表示关闭“BCL_BASE_OVERRIDE_STATIC”.

## Traits method naming convention (特征方法命名约定)

### Base name (基本名称)
Name prefix (名称前缀):
- (None): `.NET` BCL Function (`.NET` BCL 函数)。
- `Y`: mY functions (自创的统一风格函数).

Name suffix (名称后缀):
- `Each128`: Process each 128-bit lane independently, i.e. x86 style（独立处理每个128位泳道，即x86风格）。
- `G2`/`G3`/`G4`: Group of 4 elements (2/3/4 个元素的组).
- `X2`/`X3`/`X4`: 参数数量翻倍的版本。例如 Vector128<double> 只有2个元素，想做 ShuffleG4 运算的话, 需用 X2 的版本.

### Style suffix (风格后缀)
方法的名称为“BaseName + "_" + StyleSuffix”.

Style suffix (风格后缀):
- `Args`: 用于检查及转换参数. 用本方法转换参数后, 随后可调用 Core 版方法.
- `Core`: 核心运算. 需先调用 Args 版函数, 才可调用本方法. 例如 YShuffleG4 .
- `Const`: 常量版. 用于能确保参数在范围内, 且参数是常量时. 参数会用 `ConstExpected` attribute 说明范围.
- `Fast`: 快速版. 用于能确保参数在范围内, 且参数是变量时. 参数会用 `ConstExpected` attribute 说明范围.

注: Base name (基本名称)必会提供加速类型检测的属性. 而对于风格后缀, 一般不用提供加速类型检测.


